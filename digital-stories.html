<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Stories | Food Industry Asia (FIA)</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/custom.css">
    <link rel="icon" href="images/cropped-favicon-32x32.png" sizes="32x32">
    <link rel="icon" href="images/cropped-favicon-192x192.png" sizes="192x192">
    <link rel="apple-touch-icon" href="images/cropped-favicon-180x180.png">
</head>

<body>
    <style>
        .video-meta {
            display: none;
        }
    </style>
    <header class="site-header">
        <div class="header-bottom">
            <div class="container">
                <nav class="navbar navbar-expand-lg py-2">
                    <a href="/" class="logo-link mb-2">
                        <img src="images/weblogobk.png" alt="foodIndustry" height="80" width="150" class="logo-main">
                    </a>
                    <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                        data-bs-target="#mainNav">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse pt-2" id="mainNav">
                        <ul class="navbar-nav me-auto ms-lg-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="/">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/about.html">About Us</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/membership.html">Membership & Benefits</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/blogs.html">Insights Hub</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/events.html">Events</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle active" href="#" data-bs-toggle="dropdown">Videos</a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="/digital-stories.html"> Digital Stories</a></li>
                                    <li><a class="dropdown-item" href="https://fiatv.foodindustry.asia/">Feeding Asia's
                                            Future</a></li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/contact.html">Contact Us</a>
                            </li>
                        </ul>
                        <div class="login-area py-3 py-lg-0">
                            <img src="images/login-icon.png" width="26" height="18" alt="Login">
                            <a href="#">Members Login</a>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>
    <!-- Page Header -->
    <section class="page-header">
        <div class="page-header-overlay"></div>
        <img src="images/Digital Stories - Fade Top Banner.webp" class="page-header-image" alt="About Us">
        <div class="container" style="z-index: 2;">
            <div class="page-header flex-column" style="min-height: auto;">
                <h1 class="page-title text-white">Digital Stories</h1>
                <p class="page-subtitle text-white">Explore our collection of industry insights and stories</p>
            </div>
        </div>
    </section>
    <main class="digital-stories-container">
        <div class="container">
            <!-- <div class="upload-section">
                <button class="btn-upload" id="uploadBtn">
                    <i class="fa-solid fa-plus"></i>
                    Upload Video
                </button>
            </div> -->

            <div class="search-filter-bar">
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search videos...">
                </div>
                <select class="filter-dropdown" id="sortFilter">
                    <option value="recent">Most Recent</option>
                    <option value="popular">Most Popular</option>
                    <option value="title">Title A-Z</option>
                </select>
            </div>

            <div class="videos-grid" id="videosGrid"></div>

            <div class="no-results" id="noResults" style="display: none;">
                <i class="fa-solid fa-video-slash"></i>
                <h3>No videos found</h3>
                <p>Try adjusting your search or filters</p>
            </div>

            <div class="pagination-container" id="paginationContainer">
                <div class="pagination-info" id="paginationInfo"></div>
                <div class="pagination-controls" id="paginationControls"></div>
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="uploadModal">
        <div class="overflow_scroll">
            <div class="upload-modal">
                <div class="modal-header">
                    <h2 class="modal-title" id="modalTitle">Upload Video</h2>
                    <button class="close-btn" id="closeModal" aria-label="Close">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>

                <form id="uploadForm">
                    <div class="modal-body">
                        <input type="hidden" id="editVideoId">

                        <div class="form-group">
                            <label class="form-label required" for="videoTitle">Video Title</label>
                            <input type="text" class="form-input" id="videoTitle" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Upload Method</label>
                            <div class="upload-method-tabs">
                                <button type="button" class="upload-method-tab active" data-method="youtube">
                                    <i class="fa-brands fa-youtube"></i>
                                    YouTube URL
                                </button>
                                <button type="button" class="upload-method-tab" data-method="file">
                                    <i class="fa-solid fa-file-video"></i>
                                    Upload Video
                                </button>
                            </div>
                        </div>

                        <div class="upload-method-content" id="youtubeUpload">
                            <div class="form-group">
                                <label class="form-label required" for="videoUrl">YouTube Video URL</label>
                                <input type="url" class="form-input" id="videoUrl"
                                    placeholder="https://www.youtube.com/watch?v=...">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Thumbnail Preview</label>
                                <div class="upload-area" id="youtubeThumbnailPreview">
                                    <i class="fa-solid fa-image upload-icon"></i>
                                    <p class="upload-text">Thumbnail will appear here</p>
                                    <p class="upload-hint">Enter a YouTube URL above</p>
                                </div>
                            </div>
                        </div>

                        <div class="upload-method-content" id="fileUpload" style="display: none;">
                            <div class="form-group">
                                <label class="form-label required">Video File</label>
                                <div class="upload-area" id="videoFileUploadArea">
                                    <input type="file" class="file-input" id="videoFileInput" accept="video/*">
                                    <i class="fa-solid fa-cloud-arrow-up upload-icon"></i>
                                    <p class="upload-text">Click to upload video</p>
                                    <p class="upload-hint">Supported formats: MP4, WebM, MOV (Max: 100MB)</p>
                                </div>
                                <div id="videoFilePreview" class="file-preview" style="display: none;">
                                    <video id="videoPreviewPlayer" controls></video>
                                    <button type="button" class="remove-file-btn" id="removeVideoFile">
                                        <i class="fa-solid fa-xmark"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label required">Thumbnail Image</label>
                                <div class="upload-area" id="thumbnailFileUploadArea">
                                    <input type="file" class="file-input" id="thumbnailFileInput" accept="image/*">
                                    <i class="fa-solid fa-image upload-icon"></i>
                                    <p class="upload-text">Click to upload thumbnail</p>
                                    <p class="upload-hint">Recommended: 1280x720px (Max: 5MB)</p>
                                </div>
                                <div id="thumbnailFilePreview" class="file-preview" style="display: none;">
                                    <img id="thumbnailPreviewImage" alt="Thumbnail preview">
                                    <button type="button" class="remove-file-btn" id="removeThumbnailFile">
                                        <i class="fa-solid fa-xmark"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" id="cancelBtn">Cancel</button>
                        <button type="submit" class="btn-primary" id="submitBtn">Add Video</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-main py-5">
            <div class="container">
                <div class="row g-4">
                    <div class="col-lg-4 col-md-6">
                        <div class="footer-about">
                            <img src="images/weblogo.png" width="311" height="80" alt="foodIndustry"
                                class="footer-logo mb-4">
                            <p class="footer-description">Keep up with the latest industry insights, policy updates, and innovation stories from across Asia's food and beverage community.
                            </p>
                            <div class="footer-social">
                                <a href="https://www.linkedin.com/company/food-industry-asia" aria-label="LinkedIn"><i
                                        class="fa-brands fa-linkedin"></i></a>
                                <a href="https://www.youtube.com/c/foodindustryasia" aria-label="YouTube"><i
                                        class="fa-brands fa-youtube"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="footer-contact">
                            <h4 class="footer-title">Contact Us</h4>
                            <div class="contact-info-list">
                                <div class="contact-info-item">
                                    <i class="fa-solid fa-location-dot"></i>
                                    <div class="contact-details">
                                        <span class="contact-label">Address:</span>
                                        <span>Food Industry Asia (FIA),<br>
                                            33 Mohamed Sultan Road #03-02<br>
                                            Singapore 238977</span>
                                    </div>
                                </div>
                                <div class="contact-info-item">
                                    <i class="fa-solid fa-envelope"></i>
                                    <div class="contact-details">
                                        <span class="contact-label">Email:</span>
                                        <a href="mailto:info@foodindustry.asia">info@foodindustry.asia</a>
                                    </div>
                                </div>
                                <div class="contact-info-item">
                                    <i class="fa-solid fa-phone"></i>
                                    <div class="contact-details">
                                        <span class="contact-label">Phone:</span>
                                        <a href="tel:+6562353854">(+65) 6235 3854</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-12">
                        <div class="footer-links-wrapper">
                            <div class="row">
                                <div class="col-12">
                                    <h4 class="footer-title">Quick Links</h4>
                                    <div class="row">
                                        <div class="col-6">
                                            <ul class="footer-menu">
                                                <li><a href="/index.html"><i class="fa-solid fa-chevron-right"></i>
                                                        Home</a>
                                                </li>
                                                <li><a href="/about.html"><i class="fa-solid fa-chevron-right"></i>
                                                        About Us</a>
                                                </li>
                                                <li><a href="/membership.html"><i class="fa-solid fa-chevron-right"></i>
                                                        Membership & Benefits</a></li>
                                                <li><a href="/events.html"><i class="fa-solid fa-chevron-right"></i>
                                                        Events</a>
                                                </li>
                                                <li class="footer-dropdown">
                                                    <a onclick="this.parentElement.classList.toggle('active')"><i
                                                            class="fa-solid fa-chevron-right"></i> FIA TV</a>
                                                    <ul class="footer-dropdown-menu">
                                                        <li><a href="/digital-stories.html">Digital Stories</a></li>
                                                        <li><a href="https://fiatv.foodindustry.asia/">Feeding Asia's
                                                                Future</a>
                                                        </li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="col-6">
                                            <ul class="footer-menu">
                                                <li><a href="/blogs.html"><i class="fa-solid fa-chevron-right"></i>
                                                        Insights
                                                        Hub</a></li>
                                                <li><a href="/contact.html"><i class="fa-solid fa-chevron-right"></i>
                                                        Contact Us</a></li>
                                                <li><a href="#"><i class="fa-solid fa-chevron-right"></i>
                                                        Members Login</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom py-3">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-6 text-center text-md-start">
                        <p class="copyright-text mb-0">Â© 2025 Food Industry Asia (FIA). All Rights Reserved.</p>
                    </div>
                    <div class="col-md-6 text-center text-md-end">
                        <ul class="footer-bottom-links">
                            <li><a href="/privacy-policy/">Privacy Policy</a></li>
                            <li><a href="/terms-conditions/">Terms & Conditions</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const initialVideos = [
            {
                id: 1,
                title: "Processed Food: Friend or Foe? Unpacking the Myths and Facts",
                videoUrl: 'https://www.youtube.com/watch?v=EYMxlNqlv8s',
                videoId: 'EYMxlNqlv8s',
                duration: '0:00', // Placeholder - would need actual duration
                views: 0, // Placeholder - would need actual view count
                date: new Date() // Current date as placeholder
            },
            {
                id: 2,
                title: "Understanding the consumer mindset",
                videoUrl: 'https://www.youtube.com/watch?v=Ye8hCmHHi-4',
                videoId: 'Ye8hCmHHi-4',
                duration: '0:00',
                views: 0,
                date: new Date()
            },
            {
                id: 3,
                title: "Are all processed foods bad for you?",
                videoUrl: 'https://www.youtube.com/watch?v=47mp_hScqcA',
                videoId: '47mp_hScqcA',
                duration: '0:00',
                views: 0,
                date: new Date()
            },
            {
                id: 4,
                title: "Mythbusters: Processed Foods - A Food Scientist's View",
                videoUrl: 'https://www.youtube.com/watch?v=R3QrUd_cq08',
                videoId: 'R3QrUd_cq08',
                duration: '0:00',
                views: 0,
                date: new Date()
            },
            {
                id: 5,
                title: "Mythbusters: Processed Food",
                videoUrl: 'https://www.youtube.com/watch?v=1H98TSyMK_I',
                videoId: '1H98TSyMK_I',
                duration: '0:00',
                views: 0,
                date: new Date()
            },
            {
                id: 6,
                title: "Feeding Asia's Future 24 - Consumer Behaviour",
                videoUrl: 'https://www.youtube.com/watch?v=n-SXSdLvTNw',
                videoId: 'n-SXSdLvTNw',
                duration: '0:00',
                views: 0,
                date: new Date()
            },
            {
                id: 7,
                title: "Feeding Asia's Future 2024 - Innovation",
                videoUrl: 'https://www.youtube.com/watch?v=adcsPGO402I',
                videoId: 'adcsPGO402I',
                duration: '0:00',
                views: 0,
                date: new Date()
            },
            {
                id: 8,
                title: "Feeding Asia's Future 2024 - Sustainability",
                videoUrl: 'https://www.youtube.com/watch?v=8FC-CrJLG3A',
                videoId: '8FC-CrJLG3A',
                duration: '0:00',
                views: 0,
                date: new Date()
            },
            {
                id: 9,
                title: "Feeding Asia's Future 2024 - Nutrition & Fortification",
                videoUrl: 'https://www.youtube.com/watch?v=8652oKv38KE',
                videoId: '8652oKv38KE',
                duration: '0:00',
                views: 0,
                date: new Date()
            }
        ];
        class DigitalStories {
            constructor() {
                this.videos = this.loadVideos();
                this.currentPage = 1;
                this.itemsPerPage = 6;
                this.filteredVideos = [];
                this.activeOptionsDropdown = null;
                this.init();
                console.log('Total videos:', this.videos.length);
                console.log('Items per page:', this.itemsPerPage);
                console.log('Total pages:', Math.ceil(this.videos.length / this.itemsPerPage));
            }

            loadVideos() {
                const stored = localStorage.getItem('digitalStories');
                if (stored) {
                    const videos = JSON.parse(stored);
                    return videos.map(v => ({
                        ...v,
                        date: new Date(v.date)
                    }));
                }
                localStorage.setItem('digitalStories', JSON.stringify(initialVideos));
                return initialVideos;
            }

            saveVideos() {
                localStorage.setItem('digitalStories', JSON.stringify(this.videos));
            }

            extractYouTubeId(url) {
                const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
                const match = url.match(regex);
                return match ? match[1] : null;
            }

            getThumbnailUrl(videoId) {
                return `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
            }

            filterAndSortVideos(searchTerm = '') {
                let filtered = this.videos;

                if (searchTerm) {
                    filtered = this.videos.filter(video =>
                        video.title.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }

                const sortValue = document.getElementById('sortFilter').value;
                if (sortValue === 'recent') {
                    filtered.sort((a, b) => b.date - a.date);
                } else if (sortValue === 'popular') {
                    filtered.sort((a, b) => b.views - a.views);
                } else if (sortValue === 'title') {
                    filtered.sort((a, b) => a.title.localeCompare(b.title));
                }

                return filtered;
            }

            renderVideos(filter = '') {
                const grid = document.getElementById('videosGrid');
                const noResults = document.getElementById('noResults');

                // Store filtered videos
                this.filteredVideos = this.filterAndSortVideos(filter);

                if (this.filteredVideos.length === 0) {
                    grid.innerHTML = '';
                    noResults.style.display = 'block';
                    document.getElementById('paginationContainer').style.display = 'none';
                    return;
                }

                noResults.style.display = 'none';

                // Calculate pagination
                const totalPages = Math.ceil(this.filteredVideos.length / this.itemsPerPage);

                // Handle current page bounds
                if (this.currentPage > totalPages && totalPages > 0) {
                    this.currentPage = totalPages;
                } else if (this.currentPage < 1) {
                    this.currentPage = 1;
                }

                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = Math.min(startIndex + this.itemsPerPage, this.filteredVideos.length);
                const paginatedVideos = this.filteredVideos.slice(startIndex, endIndex);

                // Render video cards
                grid.innerHTML = paginatedVideos.map(video => `
                    <div class="video-card" data-video-id="${video.id}">
                        <div class="video-thumbnail" onclick="window.digitalStories.playVideo(${video.id})">
                            <img src="${this.getThumbnailUrl(video.videoId)}" alt="${video.title}">
                            <div class="play-overlay">
                                <div class="play-button">
                                    <i class="fa-solid fa-play"></i>
                                </div>
                            </div>
                            <span class="video-duration">${video.duration}</span>
                        </div>
                        <div class="video-options-menu">
                            <button class="options-toggle-btn" onclick="window.digitalStories.toggleOptions(event, ${video.id})" aria-label="Options">
                                <i class="fa-solid fa-ellipsis-vertical"></i>
                            </button>
                            <div class="options-dropdown" id="options-${video.id}">
                                <button class="options-dropdown-item" onclick="window.digitalStories.editVideo(${video.id})">
                                    <i class="fa-solid fa-pen"></i>
                                    Edit
                                </button>
                                <button class="options-dropdown-item delete" onclick="window.digitalStories.deleteVideo(${video.id})">
                                    <i class="fa-solid fa-trash"></i>
                                    Delete
                                </button>
                            </div>
                        </div>
                        <div class="video-info" onclick="window.digitalStories.playVideo(${video.id})">
                            <h3 class="video-title">${video.title}</h3>
                            <div class="video-meta">
                                <div class="video-stats">
                                    <span class="video-stat">
                                        <i class="fa-solid fa-eye"></i>
                                        ${video.views.toLocaleString()}
                                    </span>
                                    <span class="video-stat">
                                        <i class="fa-solid fa-calendar"></i>
                                        ${this.formatDate(video.date)}
                                    </span>
                                </div>
                            </div>
                            <div class="video-actions" onclick="event.stopPropagation()">
                                <button class="action-btn" onclick="window.digitalStories.downloadVideo('${video.videoUrl}')"
                                        title="Download">
                                    <i class="fa-solid fa-download"></i>
                                </button>
                                <button class="action-btn" onclick="window.digitalStories.shareVideo('${video.title}', '${video.videoUrl}')"
                                        title="Share">
                                    <i class="fa-solid fa-share"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');

                // Always render pagination, even if only 1 page
                this.renderPagination();
            }

            renderPagination() {
                const totalPages = Math.ceil(this.filteredVideos.length / this.itemsPerPage);
                const paginationContainer = document.getElementById('paginationContainer');
                const paginationInfo = document.getElementById('paginationInfo');
                const paginationControls = document.getElementById('paginationControls');

                // Always show the container, but adjust content based on pages
                paginationContainer.style.display = 'flex';

                if (totalPages <= 1) {
                    paginationInfo.textContent = `Showing all ${this.filteredVideos.length} videos`;
                    paginationControls.innerHTML = ''; // No pagination controls needed
                    return;
                }

                const startItem = (this.currentPage - 1) * this.itemsPerPage + 1;
                const endItem = Math.min(this.currentPage * this.itemsPerPage, this.filteredVideos.length);
                paginationInfo.textContent = `Showing ${startItem}-${endItem} of ${this.filteredVideos.length} videos`;

                let controlsHTML = `
                    <button class="pagination-btn nav-btn" onclick="window.digitalStories.goToPage(${this.currentPage - 1})" 
                            ${this.currentPage === 1 ? 'disabled' : ''}>
                        <i class="fa-solid fa-chevron-left"></i>
                        Previous
                    </button>
                `;

                const maxVisiblePages = 5;
                let startPage = Math.max(1, this.currentPage - Math.floor(maxVisiblePages / 2));
                let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

                if (endPage - startPage < maxVisiblePages - 1) {
                    startPage = Math.max(1, endPage - maxVisiblePages + 1);
                }

                if (startPage > 1) {
                    controlsHTML += `<button class="pagination-btn" onclick="window.digitalStories.goToPage(1)">1</button>`;
                    if (startPage > 2) {
                        controlsHTML += `<span style="padding: 0 8px; color: #999;">...</span>`;
                    }
                }

                for (let i = startPage; i <= endPage; i++) {
                    controlsHTML += `
                        <button class="pagination-btn ${i === this.currentPage ? 'active' : ''}" 
                                onclick="window.digitalStories.goToPage(${i})">
                            ${i}
                        </button>
                    `;
                }

                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        controlsHTML += `<span style="padding: 0 8px; color: #999;">...</span>`;
                    }
                    controlsHTML += `<button class="pagination-btn" onclick="window.digitalStories.goToPage(${totalPages})">${totalPages}</button>`;
                }

                controlsHTML += `
                    <button class="pagination-btn nav-btn" onclick="window.digitalStories.goToPage(${this.currentPage + 1})" 
                            ${this.currentPage === totalPages ? 'disabled' : ''}>
                        Next
                        <i class="fa-solid fa-chevron-right"></i>
                    </button>
                `;

                paginationControls.innerHTML = controlsHTML;
            }

            goToPage(page) {
                const totalPages = Math.ceil(this.filteredVideos.length / this.itemsPerPage);
                if (page < 1 || page > totalPages) return;

                this.currentPage = page;
                this.renderVideos(document.getElementById('searchInput').value);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            toggleOptions(event, videoId) {
                event.stopPropagation();
                const dropdown = document.getElementById(`options-${videoId}`);

                if (this.activeOptionsDropdown && this.activeOptionsDropdown !== dropdown) {
                    this.activeOptionsDropdown.classList.remove('active');
                }

                dropdown.classList.toggle('active');
                this.activeOptionsDropdown = dropdown.classList.contains('active') ? dropdown : null;
            }

            editVideo(id) {
                const video = this.videos.find(v => v.id === id);
                if (!video) return;

                document.getElementById('modalTitle').textContent = 'Edit Video';
                document.getElementById('submitBtn').textContent = 'Update Video';
                document.getElementById('editVideoId').value = id;
                document.getElementById('videoTitle').value = video.title;

                // Check if video is YouTube or uploaded file
                if (video.videoUrl && video.videoUrl.includes('youtube')) {
                    // YouTube video - show YouTube tab
                    document.querySelector('.upload-method-tab[data-method="youtube"]').click();
                    document.getElementById('videoUrl').value = video.videoUrl;

                    const thumbnailUrl = this.getThumbnailUrl(video.videoId);
                    document.getElementById('youtubeThumbnailPreview').innerHTML = `
                        <img src="${thumbnailUrl}" alt="Thumbnail"
                             style="width: 100%; border-radius: 8px;">
                    `;
                } else {
                    // Uploaded file - show file tab (note: editing file uploads just updates title for now)
                    document.querySelector('.upload-method-tab[data-method="file"]').click();
                }

                this.openModal();
                this.closeAllDropdowns();
            }

            deleteVideo(id) {
                if (!confirm('Are you sure you want to delete this video?')) return;

                this.videos = this.videos.filter(v => v.id !== id);
                this.saveVideos();

                const totalPages = Math.ceil(this.filterAndSortVideos(document.getElementById('searchInput').value).length / this.itemsPerPage);
                if (this.currentPage > totalPages && this.currentPage > 1) {
                    this.currentPage = totalPages;
                }

                this.renderVideos(document.getElementById('searchInput').value);
                this.closeAllDropdowns();
            }

            closeAllDropdowns() {
                document.querySelectorAll('.options-dropdown').forEach(dropdown => {
                    dropdown.classList.remove('active');
                });
                this.activeOptionsDropdown = null;
            }

            formatDate(date) {
                const now = new Date();
                const diff = Math.floor((now - date) / (1000 * 60 * 60 * 24));

                if (diff === 0) return 'Today';
                if (diff === 1) return 'Yesterday';
                if (diff < 7) return `${diff} days ago`;
                if (diff < 30) return `${Math.floor(diff / 7)} weeks ago`;
                if (diff < 365) return `${Math.floor(diff / 30)} months ago`;
                return `${Math.floor(diff / 365)} years ago`;
            }

            playVideo(id) {
                const video = this.videos.find(v => v.id === id);
                if (video) {
                    window.location.href = `video-player.html?id=${id}`;
                }
            }

            downloadVideo(url) {
                window.open(url, '_blank');
            }

            shareVideo(title, url) {
                if (navigator.share) {
                    navigator.share({
                        title: title,
                        url: url
                    });
                } else {
                    navigator.clipboard.writeText(url);
                    alert('Link copied to clipboard!');
                }
            }

            addVideo(title, url) {
                const videoId = this.extractYouTubeId(url);
                if (!videoId) {
                    alert('Invalid YouTube URL');
                    return;
                }

                const newVideo = {
                    id: Date.now(),
                    title: title,
                    videoUrl: url,
                    videoId: videoId,
                    duration: '0:00',
                    views: 0,
                    date: new Date()
                };

                this.videos.unshift(newVideo);
                this.saveVideos();
                this.currentPage = 1;
                this.renderVideos();
                this.closeModal();
            }

            updateVideo(id, title, url) {
                const videoId = this.extractYouTubeId(url);
                if (!videoId) {
                    alert('Invalid YouTube URL');
                    return;
                }

                const videoIndex = this.videos.findIndex(v => v.id === id);
                if (videoIndex === -1) return;

                this.videos[videoIndex] = {
                    ...this.videos[videoIndex],
                    title: title,
                    videoUrl: url,
                    videoId: videoId
                };

                this.saveVideos();
                this.renderVideos(document.getElementById('searchInput').value);
                this.closeModal();
            }

            openModal() {
                document.getElementById('uploadModal').classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            resetUploadForm() {
                // Reset form inputs
                document.getElementById('uploadForm').reset();
                document.getElementById('editVideoId').value = '';

                // Reset YouTube preview
                document.getElementById('youtubeThumbnailPreview').innerHTML = `
                    <i class="fa-solid fa-image upload-icon"></i>
                    <p class="upload-text">Thumbnail will appear here</p>
                    <p class="upload-hint">Enter a YouTube URL above</p>
                `;

                // Reset file uploads
                document.getElementById('videoFileInput').value = '';
                document.getElementById('thumbnailFileInput').value = '';
                document.getElementById('videoPreviewPlayer').src = '';
                document.getElementById('thumbnailPreviewImage').src = '';
                document.getElementById('videoFilePreview').style.display = 'none';
                document.getElementById('thumbnailFilePreview').style.display = 'none';
                document.getElementById('videoFileUploadArea').style.display = 'block';
                document.getElementById('thumbnailFileUploadArea').style.display = 'block';

                // Reset to YouTube tab
                document.querySelectorAll('.upload-method-tab').forEach(t => t.classList.remove('active'));
                document.querySelector('.upload-method-tab[data-method="youtube"]').classList.add('active');
                document.getElementById('youtubeUpload').style.display = 'block';
                document.getElementById('fileUpload').style.display = 'none';
            }

            closeModal() {
                document.getElementById('uploadModal').classList.remove('active');
                document.body.style.overflow = '';
                document.getElementById('modalTitle').textContent = 'Upload Video';
                document.getElementById('submitBtn').textContent = 'Add Video';
                this.resetUploadForm();
            }

            init() {
                this.renderVideos();

                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.currentPage = 1;
                    this.renderVideos(e.target.value);
                });

                document.getElementById('sortFilter').addEventListener('change', () => {
                    this.currentPage = 1;
                    this.renderVideos(document.getElementById('searchInput').value);
                });

                const uploadBtn = document.getElementById('uploadBtn');
                if (uploadBtn) {
                    uploadBtn.addEventListener('click', () => {
                        this.openModal();
                    });
                }

                document.getElementById('closeModal').addEventListener('click', () => {
                    this.closeModal();
                });

                document.getElementById('cancelBtn').addEventListener('click', () => {
                    this.closeModal();
                });

                document.getElementById('uploadModal').addEventListener('click', (e) => {
                    if (e.target.id === 'uploadModal') {
                        this.closeModal();
                    }
                });

                // Upload method tab switching
                document.querySelectorAll('.upload-method-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        const method = tab.dataset.method;

                        // Update active tab
                        document.querySelectorAll('.upload-method-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');

                        // Show/hide content
                        document.getElementById('youtubeUpload').style.display = method === 'youtube' ? 'block' : 'none';
                        document.getElementById('fileUpload').style.display = method === 'file' ? 'block' : 'none';
                    });
                });

                // YouTube URL input handler
                document.getElementById('videoUrl').addEventListener('input', (e) => {
                    const videoId = this.extractYouTubeId(e.target.value);
                    const preview = document.getElementById('youtubeThumbnailPreview');

                    if (videoId) {
                        const thumbnailUrl = this.getThumbnailUrl(videoId);
                        preview.innerHTML = `
                            <img src="${thumbnailUrl}" alt="Thumbnail"
                                 style="width: 100%; border-radius: 8px;">
                        `;
                    } else {
                        preview.innerHTML = `
                            <i class="fa-solid fa-image upload-icon"></i>
                            <p class="upload-text">Thumbnail will appear here</p>
                            <p class="upload-hint">Enter a valid YouTube URL</p>
                        `;
                    }
                });

                // Video file upload handler
                const videoFileUploadArea = document.getElementById('videoFileUploadArea');
                const videoFileInput = document.getElementById('videoFileInput');
                const videoFilePreview = document.getElementById('videoFilePreview');
                const videoPreviewPlayer = document.getElementById('videoPreviewPlayer');

                videoFileUploadArea.addEventListener('click', () => {
                    videoFileInput.click();
                });

                videoFileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        // Validate file size (100MB max)
                        if (file.size > 100 * 1024 * 1024) {
                            alert('Video file size exceeds 100MB. Please choose a smaller file.');
                            videoFileInput.value = '';
                            return;
                        }

                        // Validate file type
                        if (!file.type.startsWith('video/')) {
                            alert('Please select a valid video file.');
                            videoFileInput.value = '';
                            return;
                        }

                        // Show preview
                        const fileURL = URL.createObjectURL(file);
                        videoPreviewPlayer.src = fileURL;
                        videoFileUploadArea.style.display = 'none';
                        videoFilePreview.style.display = 'block';
                    }
                });

                document.getElementById('removeVideoFile').addEventListener('click', (e) => {
                    e.stopPropagation();
                    videoFileInput.value = '';
                    videoPreviewPlayer.src = '';
                    videoFilePreview.style.display = 'none';
                    videoFileUploadArea.style.display = 'block';
                });

                // Thumbnail file upload handler
                const thumbnailFileUploadArea = document.getElementById('thumbnailFileUploadArea');
                const thumbnailFileInput = document.getElementById('thumbnailFileInput');
                const thumbnailFilePreview = document.getElementById('thumbnailFilePreview');
                const thumbnailPreviewImage = document.getElementById('thumbnailPreviewImage');

                thumbnailFileUploadArea.addEventListener('click', () => {
                    thumbnailFileInput.click();
                });

                thumbnailFileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        // Validate file size (5MB max)
                        if (file.size > 5 * 1024 * 1024) {
                            alert('Thumbnail file size exceeds 5MB. Please choose a smaller file.');
                            thumbnailFileInput.value = '';
                            return;
                        }

                        // Validate file type
                        if (!file.type.startsWith('image/')) {
                            alert('Please select a valid image file.');
                            thumbnailFileInput.value = '';
                            return;
                        }

                        // Show preview
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            thumbnailPreviewImage.src = event.target.result;
                            thumbnailFileUploadArea.style.display = 'none';
                            thumbnailFilePreview.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });

                document.getElementById('removeThumbnailFile').addEventListener('click', (e) => {
                    e.stopPropagation();
                    thumbnailFileInput.value = '';
                    thumbnailPreviewImage.src = '';
                    thumbnailFilePreview.style.display = 'none';
                    thumbnailFileUploadArea.style.display = 'block';
                });

                document.getElementById('uploadForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const title = document.getElementById('videoTitle').value.trim();
                    const editId = document.getElementById('editVideoId').value;

                    // Check which upload method is active
                    const activeMethod = document.querySelector('.upload-method-tab.active').dataset.method;

                    if (activeMethod === 'youtube') {
                        const url = document.getElementById('videoUrl').value.trim();

                        if (!title || !url) {
                            alert('Please fill in all required fields.');
                            return;
                        }

                        if (editId) {
                            this.updateVideo(parseInt(editId), title, url);
                        } else {
                            this.addVideo(title, url);
                        }
                    } else {
                        // File upload method
                        const videoFile = document.getElementById('videoFileInput').files[0];
                        const thumbnailFile = document.getElementById('thumbnailFileInput').files[0];

                        if (!title) {
                            alert('Please enter a video title.');
                            return;
                        }

                        if (!editId && !videoFile) {
                            alert('Please select a video file.');
                            return;
                        }

                        if (!editId && !thumbnailFile) {
                            alert('Please select a thumbnail image.');
                            return;
                        }

                        // Note: Actual file upload would be handled by backend
                        // For now, we'll just show a message
                        alert('File upload functionality requires server-side implementation. This preview shows the UI/UX flow. In production, files would be uploaded to the server here.');

                        // For demo purposes, if user still wants to add it (in edit mode, just update title)
                        if (editId) {
                            const video = this.videos.find(v => v.id === parseInt(editId));
                            if (video) {
                                video.title = title;
                                this.saveVideos();
                                this.renderVideos(document.getElementById('searchInput').value);
                                this.closeModal();
                            }
                        }
                    }
                });

                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.video-options-menu')) {
                        this.closeAllDropdowns();
                    }
                });

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        if (document.getElementById('uploadModal').classList.contains('active')) {
                            this.closeModal();
                        }
                        this.closeAllDropdowns();
                    }
                });
            }
        }

        (function () {
            window.digitalStories = new DigitalStories();
        })();
    </script>
</body>

</html>
